define(["jquery","core/ajax","core/str","core/notification"],function(a,b,c,d){function e(a,c){var d={methodname:a,args:c},e=b.call([d])[0];return e}function f(a,b,c,h,i,j){e("tool_textcleanup_cleanup_text",{query:a,types:b,maxrecords:g}).done(function(d){j.text(h+"/"+c),d&&(0===d.cleanedrecords?(i.prop("disabled",!1),j.text("")):f(a,b,c,h+d.cleanedrecords,i,j))}).fail(function(a){i.prop("disabled",!1),d.exception(a)})}var g=50;return{init:function(b,g,h,i){a("document").ready(function(){c.get_strings([{key:"dataloading",component:"tool_textcleanup"},{key:"reloaddata",component:"tool_textcleanup"}]).then(function(c){var j=a("#"+b+" input[type=submit]").first();i?j.val(c[0]):j.val(c[1]),j.click(function(a){a.preventDefault(),j.val(c[0]),j.prop("disabled",!0),e("tool_textcleanup_build_text_table",[]).done(function(){j.val(c[1]),j.prop("disabled",!1)}).fail(function(a){j.prop("disabled",!1),j.val(c[0]),d.exception(a)})});var k=a("#"+h).serializeArray(),l=a("#"+h+" #id_search").val(),m=k.map(function(a){return a.name.startsWith("types[")&&""!=a.value?a.value:null}).filter(function(a){return null!==a}),n=a("#"+g+" input[type=submit]").first();n.addClass("btn-danger"),n.click(function(b){b.preventDefault(),n.prop("disabled",!0);var c=a("#infoarea");e("tool_textcleanup_get_count_search",{query:l,types:m}).done(function(a){a.searchcount?f(l,m,a.searchcount,0,n,c):n.prop("disabled",!1)}).fail(function(a){n.prop("disabled",!1),d.exception(a)})})}).fail(d.exception)})}}});